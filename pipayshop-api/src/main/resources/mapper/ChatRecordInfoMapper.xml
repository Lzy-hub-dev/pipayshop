<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.pipayshopapi.mapper.ChatRecordInfoMapper">


    <select id="getChatRecord" resultType="com.example.pipayshopapi.entity.vo.ChatVO">
        SELECT * FROM (
                SELECT
                    sender_id, message, send_time
                FROM
                    chat_record_info
                WHERE
                    sender_id = #{chatDataVO.senderId} and receiver_id = #{chatDataVO.receiverId} and del_flag = 0
            UNION
                SELECT
                    sender_id, message, send_time
                FROM
                    chat_record_info
                WHERE
                    sender_id = #{chatDataVO.receiverId} and receiver_id = #{chatDataVO.senderId} and del_flag = 0
        ) AS chat
        ORDER BY
            send_time DESC
        LIMIT ${chatDataVO.page}, ${chatDataVO.limit}
    </select>


    <select id="getChatRecordSum" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM (
            SELECT
                sender_id, message, send_time
            FROM
                chat_record_info
            WHERE
                sender_id = #{chatDataVO.senderId} and receiver_id = #{chatDataVO.receiverId} and del_flag = 0
        UNION
            SELECT
                sender_id, message, send_time
            FROM
                chat_record_info
            WHERE
                sender_id = #{chatDataVO.receiverId} and receiver_id = #{chatDataVO.senderId} and del_flag = 0
        ) AS chat
    </select>
</mapper>