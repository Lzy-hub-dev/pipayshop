<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.pipayshopapi.mapper.ItemCommodityInfoMapper">

    <select id="commodityOfCateList" resultType="com.example.pipayshopapi.entity.vo.commodityVO">

        SELECT commodity_id, item_commodity_name, origin_price, price, details, imags_list
        FROM item_commodity_info
        where category_id = #{categoryId} limit #{startIndex}
            , #{number}

    </select>

    <select id="listCount" resultType="java.lang.Integer">
        select count(*)
        from item_commodity_info
        where category_id = #{categoryId}
    </select>
    <select id="itemCommodityChoose" resultType="com.example.pipayshopapi.entity.vo.commodityVO">
        select commodity_id,item_commodity_name,origin_price,price,details,imags_list
        FROM item_commodity_info
        where item_id=#{itemId}
        <if test="brandId">
            and brand_id=#{brandId}
        </if>
    </select>
    <select id="itemCommodityDetail" resultType="com.example.pipayshopapi.entity.vo.CommodityDetailVO">
        select commodity_id,
               brand_id,
               item_commodity_name,
               origin_price,
               color_list,
               size_list,
               origin_address,
               accept_address_list,
               item_id,
               price,
               details,
               imags_list,
               inventory,
               free_shipping_num,
               category_id,
               coupons_list,
               tag_list,
               degree_loss
        FROM item_commodity_info
        where commodity_id = #{commodityId}
    </select>
    <select id="selectProductByItemId">
        select *
        FROM item_commodity_info c
                 INNER JOIN
             item_info i
             ON
                 c.item_id = i.item_id
    </select>
    <select id="selectCollectProductByUserId" resultType="com.example.pipayshopapi.entity.ItemCommodityInfo">
        select *
        FROM item_collection ic
                 INNER JOIN
             item_commodity_info i
             ON
                 ic.commodity_id = i.commodity_id
        WHERE ic.user_id = #{userId}
          AND i.del_flag = 0
          AND ic.`status` = 0
    </select>
    <select id="selectFollowItemByUserId" resultType="com.example.pipayshopapi.entity.ItemInfo">
        SELECT *
        FROM item_follow_focus f
                 INNER JOIN
             item_info i
             ON f.item_id = i.item_id
        WHERE f.follow_id = #{userId}
          and f.`status` = 0
          and i.`status` = 0
    </select>
    <select id="selectHistoryProductByUserId" resultType="com.example.pipayshopapi.entity.vo.ItemCommodityInfoVO">
        SELECT
            JSON_UNQUOTE(JSON_EXTRACT(i.imags_list,' $[0]')) as image ,
            i.item_commodity_name ,
            i. price,
            h.create_time  as accessTime,
            i.commodity_id
        FROM
            item_commodity_history h
                INNER JOIN
            item_commodity_info i
            ON
                h.commodity_id=i.commodity_id
        WHERE
            h.user_id=1 AND
            i.`status`=0
    </select>
</mapper>
