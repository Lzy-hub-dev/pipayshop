<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.pipayshopapi.mapper.ItemOrderMapper">

    <select id="getMyOrderByUid" resultType="com.example.pipayshopapi.entity.vo.MyItemOrderInfoVO">
        SELECT
            o.order_id, o.item_id, o.transaction_amount, o.discount, o.order_status, i.item_name, ig.origin_path as userImage
        FROM
            item_order o
        JOIN
            item_info i
        ON
            o.item_id = i.item_id
        JOIN
            image ig
        ON
            ig.image_id = i.user_image
        WHERE i.uid= #{uid}
        <choose>
            <when test="status == -1">
                and o.order_status != 3
            </when>
            <when test="status == 0">
                and o.order_status = 0
            </when>
            <otherwise>
                and o.order_status != 3 and o.order_status != 0
            </otherwise>
        </choose>
        AND
            o.del_flag=0
        ORDER BY
            o.update_time DESC
            LIMIT #{page}, #{limit}
    </select>



    <select id="getAllMyOrderByUid" resultType="java.lang.Integer">
        SELECT
            COUNT(*)
        FROM
            item_order o
        JOIN
            item_info i
        ON
            o.item_id = i.item_id
        WHERE i.uid= #{uid}
        <choose>
            <when test="status == -1">
                and o.order_status != 3
            </when>
            <when test="status == 0">
                and o.order_status = 0
            </when>
            <otherwise>
                and o.order_status != 3 and o.order_status != 0
            </otherwise>
        </choose>
        AND
            o.del_flag=0
    </select>
</mapper>
